<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>Pixy インサイト</title>
  <style>
    :root{
      --bg:#f7f7fb;
      --card:#ffffff;
      --text:#111827;
      --muted:#6b7280;
      --line:#e5e7eb;
      --pink:#fde2ea;
      --blue:#2563eb;
      --grid:#e5e7eb;
      --shadow: 0 10px 30px rgba(0,0,0,.08);
      --radius: 18px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", "Hiragino Sans", "Noto Sans JP", Arial, sans-serif;
      color:var(--text);
      background:var(--bg);
    }
    .app{
      max-width: 420px;
      margin: 0 auto;
      padding: 18px 14px 24px;
    }
    .topbar{
      display:flex; align-items:center; justify-content:space-between;
      margin-top: 10px;
      margin-bottom: 4px;
    }
    .brand{
      font-weight: 900; letter-spacing:.2px;
      font-size: 22px;
    }
    .title{
      font-weight: 900;
      font-size: 20px;
    }
    .sectionTitle{
      margin-top: 18px;
      font-weight: 900;
      font-size: 22px;
      letter-spacing:.2px;
    }
    .divider{
      height:3px;
      background: #f0b6c7;
      border-radius: 999px;
      margin: 10px 0 14px;
      opacity:.6;
    }

    .cardRow{
      display:flex;
      gap: 12px;
    }
    .card{
      background: var(--card);
      border: 1px solid rgba(0,0,0,.05);
      border-radius: 18px;
      box-shadow: 0 8px 18px rgba(0,0,0,.04);
      padding: 14px;
      flex: 1;
      min-width: 0;
    }
    .card.pink{
      background: var(--pink);
      border-color: rgba(240, 182, 199, .35);
    }
    .card h3{
      margin: 0 0 8px;
      font-size: 13px;
      color: var(--muted);
      font-weight: 900;
    }
    .bigMoney{
      font-weight: 1000;
      font-size: 36px;
      letter-spacing: .5px;
      color: var(--blue);
      margin: 2px 0 4px;
    }
    .subLine{
      display:flex; align-items:baseline; gap: 8px;
      color: var(--muted);
      font-weight: 900;
      font-size: 12px;
    }
    .subLine b{ color: var(--text); font-size: 13px; }
    .kpiGrid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px 12px;
      margin-top: 6px;
    }
    .miniKpi{
      border-radius: 12px;
      padding: 6px 6px;
    }
    .miniLabel{
      font-size: 11px;
      color: var(--muted);
      font-weight: 900;
      margin-bottom: 2px;
    }
    .miniVal{
      font-size: 22px;
      color: var(--blue);
      font-weight: 1000;
      letter-spacing:.3px;
    }

    .toggleRow{
      display:flex;
      gap: 10px;
      margin: 12px 0 10px;
    }
    .toggle{
      border: none;
      border-radius: 999px;
      padding: 10px 16px;
      font-weight: 1000;
      font-size: 14px;
      background: #e9eaef;
      color: #374151;
      cursor: pointer;
      box-shadow: inset 0 0 0 1px rgba(0,0,0,.03);
    }
    .toggle.active{
      background: #4b5563;
      color: #fff;
    }

    .chartCard{
      background: var(--card);
      border: 1px solid rgba(0,0,0,.05);
      border-radius: 18px;
      box-shadow: 0 8px 18px rgba(0,0,0,.04);
      padding: 10px 10px 12px;
      overflow: hidden;
    }
    .chartWrap{
      position:relative;
      height: 180px;
      margin-top: 4px;
      border-radius: 12px;
      background: #ffffff;
      overflow:hidden;
    }
    .chartViewport{
      position:absolute; left:0; right:0; top:0; bottom:28px;
      overflow-x:auto; overflow-y:hidden;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: none;
      cursor: grab;
    }
    .chartViewport::-webkit-scrollbar{ display:none; }
    .chartInner{
      position:relative;
      height:100%;
      width: 100%;
    }
    canvas{
      display:block;
      width:100%;
      height:100%;
    }
    .yLabels{
      position:absolute;
      right: 6px;
      top: 8px;
      bottom: 34px;
      display:flex;
      flex-direction:column;
      justify-content:space-between;
      font-size: 12px;
      color: #9ca3af;
      font-weight: 900;
      pointer-events:none;
    }
    .xLabelsViewport{
      height: 28px;
      overflow-x:auto;
      overflow-y:hidden;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: none;
    }
    .xLabelsViewport::-webkit-scrollbar{ display:none; }
    .xLabels{
      display:flex;
      gap: 0;
      padding: 0 8px;
      height: 28px;
      align-items:flex-end;
      color: #9ca3af;
      font-weight: 900;
      font-size: 12px;
      white-space:nowrap;
      user-select:none;
      width: max-content;
    }
    .xLabels span{
      width: var(--slot, 44px);
      text-align:center;
      flex: 0 0 auto;
    }

    .cursorLine{
      position:absolute;
      top: 8px;
      bottom: 8px;
      width:2px;
      background: rgba(37,99,235,.55);
      border-radius:999px;
      pointer-events:none;
      display:none;
      z-index: 3;
    }
    .tooltip{
      position:absolute;
      min-width: 90px;
      padding: 8px 10px;
      background:#fff;
      border:1px solid rgba(0,0,0,.08);
      box-shadow: 0 10px 30px rgba(0,0,0,.12);
      border-radius: 10px;
      font-size: 12px;
      font-weight:800;
      color: var(--text);
      transform: translate(-50%, -110%);
      pointer-events:none;
      display:none;
      white-space:nowrap;
      z-index: 4;
    }
    .tooltip .tLabel{
      color: var(--text);
      font-weight: 1000;
      font-size: 16px;
      margin-bottom: 2px;
    }
    .tooltip .tVal{
      color: var(--muted);
      font-weight: 1000;
      font-size: 14px;
    }

    .segRow{
      display:flex;
      gap: 10px;
      margin-top: 12px;
      margin-bottom: 10px;
    }
    .seg{
      border:none;
      border-radius:999px;
      padding: 10px 16px;
      font-weight: 1000;
      background:#e9eaef;
      color:#374151;
      cursor:pointer;
      font-size: 14px;
    }
    .seg.active{
      background:#4b5563;
      color:#fff;
    }

    .progressCard{
      background: var(--card);
      border: 1px solid rgba(0,0,0,.05);
      border-radius: 18px;
      box-shadow: 0 8px 18px rgba(0,0,0,.04);
      padding: 14px 14px 12px;
    }
    .progRow{
      margin: 14px 0 10px;
    }
    .progHead{
      display:flex; justify-content:space-between; align-items:center;
      font-weight: 1000;
      color: var(--text);
      margin-bottom: 8px;
    }
    .progHead .lab{
      font-size: 15px;
    }
    .progHead .pct{
      font-size: 18px;
    }
    .bar{
      height: 10px;
      background: #e5e7eb;
      border-radius: 999px;
      overflow:hidden;
    }
    .bar > i{
      display:block;
      height:100%;
      width: 50%;
      background: var(--blue);
      border-radius: 999px;
    }

    .tabsRow{
      display:flex; gap: 10px;
      margin-top: 10px;
    }
    .tab{
      border:none;
      border-radius: 999px;
      padding: 10px 16px;
      font-weight: 1000;
      font-size: 14px;
      background: #e9eaef;
      color: #374151;
      cursor:pointer;
    }
    .tab.active{
      background: #4b5563;
      color: #fff;
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="topbar">
      <div class="brand">Pixy</div>
      <div class="title">インサイト</div>
      <div style="width:54px"></div>
    </div>

    <div class="sectionTitle">メインデータ</div>
    <div class="divider"></div>

    <div class="cardRow" style="margin-bottom:10px">
      <div class="card pink">
        <h3>今月の報酬金</h3>
        <div class="bigMoney" id="kpiMoney">¥ 100,000</div>
        <div class="subLine">前月比 <b id="kpiMoM">101%</b></div>
      </div>

      <button class="card" id="detailCardBtn" style="text-align:left;border:1px solid rgba(0,0,0,.05);">
        <h3>鑑定データ詳細</h3>
        <div class="kpiGrid">
          <div class="miniKpi">
            <div class="miniLabel">リピート件数</div>
            <div class="miniVal" id="kpiRepeatCnt">13</div>
          </div>
          <div class="miniKpi">
            <div class="miniLabel">リピート人数</div>
            <div class="miniVal" id="kpiRepeatUsers">9</div>
          </div>
          <div class="miniKpi">
            <div class="miniLabel">鑑定件数</div>
            <div class="miniVal" id="kpiKanteiCnt">76</div>
          </div>
          <div class="miniKpi">
            <div class="miniLabel">鑑定人数</div>
            <div class="miniVal" id="kpiKanteiUsers">63</div>
          </div>
        </div>
      </button>
    </div>

    <div id="viewKpi">
      <div class="toggleRow" aria-label="グラフ切替">
        <button class="toggle active" data-mode="hour">時間別</button>
        <button class="toggle" data-mode="weekday">曜日別</button>
        <button class="toggle" data-mode="day">日別</button>
      </div>

      <div class="chartCard">
        <div class="chartWrap">
          <div class="chartViewport" id="chartViewport">
            <div class="chartInner" id="chartInner">
              <canvas id="chart"></canvas>
              <div class="cursorLine" id="cursorLine"></div>
              <div class="tooltip" id="tooltip">
                <div class="tLabel" id="tipLabel">02時</div>
                <div class="tVal" id="tipValue">¥ 800</div>
              </div>
            </div>
          </div>

          <div class="yLabels">
            <div id="yTop">1,155</div>
            <div id="yMid">770</div>
            <div id="yBot">385</div>
          </div>
        </div>

        <div class="xLabelsViewport" id="xLabelsViewport">
          <div class="xLabels" id="xLabels"></div>
        </div>
      </div>

      <div class="sectionTitle" style="margin-top:14px">詳細データ</div>
      <div class="divider"></div>

      <div class="tabsRow">
        <button class="tab active" data-tab="user">ユーザー分析</button>
        <button class="tab" data-tab="kanteishi">鑑定師分析</button>
      </div>

      <div id="tabUser">
        <div class="progressCard" style="margin-top:10px">
          <div style="font-weight:1000;margin-bottom:10px;color:#374151">年齢構成比</div>

          <div class="progRow">
            <div class="progHead"><div class="lab">18 - 24</div><div class="pct" id="p1824">41.9%</div></div>
            <div class="bar"><i id="b1824" style="width:41.9%"></i></div>
          </div>

          <div class="progRow">
            <div class="progHead"><div class="lab">25 - 34</div><div class="pct" id="p2534">30.9%</div></div>
            <div class="bar"><i id="b2534" style="width:30.9%"></i></div>
          </div>

          <div class="progRow">
            <div class="progHead"><div class="lab">35 - 44</div><div class="pct" id="p3544">12.7%</div></div>
            <div class="bar"><i id="b3544" style="width:12.7%"></i></div>
          </div>

          <div class="progRow" style="margin-bottom:0">
            <div class="progHead"><div class="lab">45 - 54</div><div class="pct" id="p4554">9.9%</div></div>
            <div class="bar"><i id="b4554" style="width:9.9%"></i></div>
          </div>
        </div>
      </div>

      <div id="tabKanteishi" style="display:none">
        <div class="progressCard" style="margin-top:10px">
          <div style="font-weight:1000;color:#374151">（ここは仮）鑑定師分析</div>
          <div style="color:#6b7280;font-weight:900;margin-top:6px;font-size:13px">ここに鑑定師別の内訳を後で追加できます。</div>
        </div>
      </div>

    </div>
  </div>

<script>
  // ====== データ（仮） ======
  const APP = {
    state: { month: "12月", mainTab: "kpi", chartMode: "hour", cursorIndex: null },
    dataByMonth: {
      "12月": {
        money: 100000, mom: 101,
        repeatCnt: 13, repeatUsers: 9,
        kanteiCnt: 76, kanteiUsers: 63,
        chart: {
          hour:    { labels: ["02時","03時","04時","05時","06時"], values: [820,860,780,815,790] },
          weekday: { labels: ["月","火","水","木","金","土","日"], values: [700,820,760,810,900,740,680] },
          day:     { labels: ["4日","5日","6日","7日","8日","9日","14日","15日","16日","17日","18日","19日"], values: [900,820,830,810,890,850,1100,980,918,900,780,650] }
        },
        age: { "18-24": 41.9, "25-34": 30.9, "35-44": 12.7, "45-54": 9.9 }
      }
    }
  };

  // ====== DOM ======
  const $ = (q)=>document.querySelector(q);
  const kpiMoney = $("#kpiMoney");
  const kpiMoM = $("#kpiMoM");
  const kpiRepeatCnt = $("#kpiRepeatCnt");
  const kpiRepeatUsers = $("#kpiRepeatUsers");
  const kpiKanteiCnt = $("#kpiKanteiCnt");
  const kpiKanteiUsers = $("#kpiKanteiUsers");

  const chartCanvas = $("#chart");
  const chartViewport = $("#chartViewport");
  const chartInner = $("#chartInner");
  const cursorLine = $("#cursorLine");
  const tooltip = $("#tooltip");
  const tipLabel = $("#tipLabel");
  const tipValue = $("#tipValue");

  const xLabelsViewport = $("#xLabelsViewport");
  const xLabels = $("#xLabels");

  // ====== KPI反映 ======
  function fmtYen(n){
    const s = Math.round(n).toLocaleString("ja-JP");
    return "¥ " + s;
  }
  function syncKpi(){
    const d = APP.dataByMonth[APP.state.month];
    kpiMoney.textContent = fmtYen(d.money);
    kpiMoM.textContent = d.mom + "%";
    kpiRepeatCnt.textContent = d.repeatCnt.toLocaleString("ja-JP");
    kpiRepeatUsers.textContent = d.repeatUsers.toLocaleString("ja-JP");
    kpiKanteiCnt.textContent = d.kanteiCnt.toLocaleString("ja-JP");
    kpiKanteiUsers.textContent = d.kanteiUsers.toLocaleString("ja-JP");

    // 年齢
    const age = d.age;
    $("#p1824").textContent = age["18-24"] + "%"; $("#b1824").style.width = age["18-24"] + "%";
    $("#p2534").textContent = age["25-34"] + "%"; $("#b2534").style.width = age["25-34"] + "%";
    $("#p3544").textContent = age["35-44"] + "%"; $("#b3544").style.width = age["35-44"] + "%";
    $("#p4554").textContent = age["45-54"] + "%"; $("#b4554").style.width = age["45-54"] + "%";
  }

  // ====== チャート描画 ======
  const chart = {
    canvas: chartCanvas,
    viewport: chartViewport,
    inner: chartInner,
    ctx: chartCanvas.getContext("2d"),
    w: 0, h: 0,
    slot: 52,
    padding: { top: 16, right: 14, bottom: 16, left: 14 },
    points: [],
    xLabelRow: xLabels,

    resize(){
      const rect = this.inner.getBoundingClientRect();
      this.w = Math.max(10, rect.width);
      this.h = Math.max(10, rect.height);
      const dpr = window.devicePixelRatio || 1;
      this.canvas.width = Math.floor(this.w * dpr);
      this.canvas.height = Math.floor(this.h * dpr);
      this.canvas.style.width = this.w + "px";
      this.canvas.style.height = this.h + "px";
      this.ctx.setTransform(dpr,0,0,dpr,0,0);
    },
    setInnerWidth(n){
      const innerW = (n-1)*this.slot + this.padding.left + this.padding.right;
      this.inner.style.width = Math.max(innerW, this.viewport.clientWidth) + "px";
      this.xLabelRow.style.setProperty("--slot", this.slot + "px");
    },
    draw(){
      const ctx = this.ctx;
      const {w,h,padding} = this;
      ctx.clearRect(0,0,w,h);
      ctx.fillStyle = "#ffffff";
      ctx.fillRect(0,0,w,h);

      const d = APP.dataByMonth[APP.state.month].chart[APP.state.chartMode];
      const values = d.values;
      const labels = d.labels;
      const n = values.length;

      this.setInnerWidth(n);

      const maxV = Math.max(...values);
      const minV = Math.min(...values);
      const padV = Math.max(1, (maxV - minV) * 0.18);
      const topV = Math.ceil((maxV + padV)/5)*5;
      const botV = Math.floor((minV - padV)/5)*5;

      $("#yTop").textContent = topV.toLocaleString("ja-JP");
      $("#yMid").textContent = Math.round((topV+botV)/2).toLocaleString("ja-JP");
      $("#yBot").textContent = botV.toLocaleString("ja-JP");

      const mapY = (v)=>{
        const t = (v - botV) / (topV - botV);
        return (h - padding.bottom - 8) - t * (h - padding.top - padding.bottom - 16);
      };
      const mapX = (i)=> padding.left + i * this.slot;

      const gridYs = [ padding.top + 8, (h + padding.top - padding.bottom)/2, h - padding.bottom - 8 ];
      ctx.strokeStyle = getComputedStyle(document.documentElement).getPropertyValue("--grid").trim() || "#e5e7eb";
      ctx.lineWidth = 1;
      ctx.setLineDash([3,4]);
      gridYs.forEach(y=>{
        ctx.beginPath();
        ctx.moveTo(padding.left, y);
        ctx.lineTo(w - padding.right, y);
        ctx.stroke();
      });
      ctx.setLineDash([]);

      const pts = [];
      for(let i=0;i<n;i++){
        pts.push({ i, x: mapX(i), y: mapY(values[i]), v: values[i] });
      }
      this.points = pts;

      const grad = ctx.createLinearGradient(0, padding.top, 0, h);
      grad.addColorStop(0, "rgba(37,99,235,.20)");
      grad.addColorStop(1, "rgba(37,99,235,0)");
      ctx.fillStyle = grad;

      ctx.beginPath();
      pts.forEach((p, idx)=>{
        if(idx===0) ctx.moveTo(p.x, p.y);
        else ctx.lineTo(p.x, p.y);
      });
      ctx.lineTo(pts[pts.length-1].x, h - padding.bottom);
      ctx.lineTo(pts[0].x, h - padding.bottom);
      ctx.closePath();
      ctx.fill();

      ctx.beginPath();
      pts.forEach((p, idx)=>{
        if(idx===0) ctx.moveTo(p.x, p.y);
        else ctx.lineTo(p.x, p.y);
      });
      ctx.lineWidth = 2;
      ctx.strokeStyle = getComputedStyle(document.documentElement).getPropertyValue("--blue").trim() || "#2563eb";
      ctx.stroke();

      const idx = (APP.state.cursorIndex==null ? Math.floor(n/2) : APP.state.cursorIndex);
      const p = pts[Math.max(0,Math.min(n-1,idx))];

      ctx.beginPath();
      ctx.arc(p.x, p.y, 4, 0, Math.PI*2);
      ctx.fillStyle = "#2563eb";
      ctx.fill();
      ctx.lineWidth = 2;
      ctx.strokeStyle = "#ffffff";
      ctx.stroke();

      renderXLabels(labels);
      renderTooltip(p.x, p.y, labels[p.i], p.v);
      autoScrollToX(p.x);
    }
  };

  function renderXLabels(labels){
    const row = chart.xLabelRow;
    row.innerHTML = "";
    labels.forEach(lab=>{
      const sp = document.createElement("span");
      sp.textContent = lab;
      row.appendChild(sp);
    });
  }

  function renderTooltip(x, y, label, value){
    cursorLine.style.display = "block";
    tooltip.style.display = "block";

    cursorLine.style.left = x + "px";

    tipLabel.textContent = label;
    tipValue.textContent = fmtYen(value);

    const minX = 54;
    const maxX = chart.inner.clientWidth - 54;
    const clampedX = Math.max(minX, Math.min(maxX, x));

    tooltip.style.left = clampedX + "px";
    tooltip.style.top = (y) + "px";
  }

  function autoScrollToX(x){
    const vp = chart.viewport;
    const left = vp.scrollLeft;
    const w = vp.clientWidth;
    const target = x - w*0.5;
    const maxScroll = vp.scrollWidth - w;
    const next = Math.max(0, Math.min(maxScroll, target));
    if(Math.abs(next-left) > 1){
      try{ vp.scrollLeft = next; }catch(_){}
    }
    try{ xLabelsViewport.scrollLeft = vp.scrollLeft; }catch(_){}
  }

  function pickIndexFromClientX(clientX){
    const d = APP.dataByMonth[APP.state.month].chart[APP.state.chartMode];
    const n = d.values.length;
    const rect = chart.viewport.getBoundingClientRect();
    const xInViewport = clientX - rect.left;
    const xInInner = xInViewport + chart.viewport.scrollLeft;
    const x0 = chart.padding.left;
    const dx = chart.slot;
    const i = Math.round((xInInner - x0) / dx);
    return Math.max(0, Math.min(n-1, i));
  }

  function attachViewportPanAndSelect(){
    const vp = chart.viewport;
    let down = false;
    let moved = false;
    let startX = 0;
    let startScroll = 0;

    vp.addEventListener("pointerdown", (e)=>{
      // タッチはネイティブスクロール優先（ここでは何もしない）
      if(e.pointerType !== "mouse") return;
      if(e.button !== 0) return;

      down = true;
      moved = false;
      startX = e.clientX;
      startScroll = vp.scrollLeft;
      vp.setPointerCapture(e.pointerId);
      vp.style.cursor = "grabbing";
    });

    vp.addEventListener("pointermove", (e)=>{
      if(!down) return;
      const dx = e.clientX - startX;
      if(Math.abs(dx) > 3) moved = true;
      vp.scrollLeft = startScroll - dx;
      xLabelsViewport.scrollLeft = vp.scrollLeft;
    });

    vp.addEventListener("pointerup", (e)=>{
      if(!down) return;
      down = false;
      vp.style.cursor = "grab";
      try{ vp.releasePointerCapture(e.pointerId);}catch(_){}
      // 動いてないなら「クリック」とみなして点を選ぶ
      if(!moved){
        APP.state.cursorIndex = pickIndexFromClientX(e.clientX);
        chart.draw();
      }
    });

    vp.addEventListener("pointercancel", (e)=>{ down = false; });

    // タッチでタップしたときに点を選べるように（スクロール後の誤爆はほぼ起きない）
    vp.addEventListener("click", (e)=>{
      if(e.detail === 0) return; // programmatic
      // マウスのクリックはpointerup側で処理済みなので二重にしない
      // ただし一部環境でpointerupが来ない場合の保険
      if(e.pointerType === "mouse") return;
      APP.state.cursorIndex = pickIndexFromClientX(e.clientX);
      chart.draw();
    }, {passive:true});

    // スマホ（指でなぞって値を出す）
    vp.addEventListener("touchstart", (e)=>{
      const t = e.touches && e.touches[0];
      if(!t) return;
      APP.state.cursorIndex = pickIndexFromClientX(t.clientX);
      chart.draw();
    }, {passive:true});

    vp.addEventListener("touchmove", (e)=>{
      const t = e.touches && e.touches[0];
      if(!t) return;
      APP.state.cursorIndex = pickIndexFromClientX(t.clientX);
      chart.draw();
    }, {passive:true});

  }

  function syncChartMode(mode){
    APP.state.chartMode = mode;
    APP.state.cursorIndex = null;
    chart.draw();
  }

  function wireUi(){
    document.querySelectorAll(".toggle").forEach(btn=>{
      btn.addEventListener("click", ()=>{
        document.querySelectorAll(".toggle").forEach(b=>b.classList.remove("active"));
        btn.classList.add("active");
        syncChartMode(btn.dataset.mode);
      });
    });

    document.querySelectorAll(".tab").forEach(btn=>{
      btn.addEventListener("click", ()=>{
        document.querySelectorAll(".tab").forEach(b=>b.classList.remove("active"));
        btn.classList.add("active");
        const tab = btn.dataset.tab;
        $("#tabUser").style.display = (tab==="user") ? "" : "none";
        $("#tabKanteishi").style.display = (tab==="kanteishi") ? "" : "none";
      });
    });

    chartViewport.addEventListener("scroll", ()=>{
      xLabelsViewport.scrollLeft = chartViewport.scrollLeft;
    }, {passive:true});

    xLabelsViewport.addEventListener("scroll", ()=>{
      chartViewport.scrollLeft = xLabelsViewport.scrollLeft;
    }, {passive:true});
  }

  (function init(){
    syncKpi();
    wireUi();

    const ro = new ResizeObserver(()=>{
      chart.resize();
      chart.draw();
    });
    ro.observe(chartInner);

    chart.resize();
    chart.draw();
    attachViewportPanAndSelect();
  })();
</script>
</body>
</html>
